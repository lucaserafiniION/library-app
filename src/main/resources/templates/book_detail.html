<!DOCTYPE html>  
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout.html}">  
<head>  
    <title>Book Details</title>  
    <style>  
        .book-details-container {  
            background-color: rgba(255, 255, 255, 0.7);  
            padding: 20px;  
            border-radius: 5px;  
            position: fixed;  
            top: 0;  
            left: 0;  
            right: 0;  
            bottom: 0;  
            overflow: auto;  
            margin-top: 60px;  
        } 
         
        .book-details {  
            display: flex;  
            justify-content: center;  
            align-items: flex-start;  
            flex-wrap: wrap;  
        }  
  
        .book-title {  
            font-weight: bold;  
            font-size: 24px;  
            margin-bottom: 20px; 
            width: 100%;  
            text-align: center;   
        }  
  
        .book-cover {  
            width: 40%;  
            max-width: 300px;  
            margin-right: 20px;  
        }  
  
        .book-info {  
            width: 50%;  
            background-color: white;  
            padding: 20px;  
            border-radius: 5px;  
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); 
        }  
  
        .back-to-books-btn {  
            display: inline-flex;  
            align-items: center;  
            text-decoration: none;  
        }  
  
        .back-to-books-icon {  
            margin-right: 5px;  
        } 
         
        .back-to-books-btn {  
		    display: inline-flex;  
		    align-items: center;  
		    text-decoration: none;  
		    background-color: #3a6cb3;  
		    color: white;  
		    padding: 5px 10px;  
		    border-radius: 5px;  
		    margin-top: 20px;  
		}   
		.similar-book {  
		    position: relative;  
		}  
		  
		.carousel-caption {  
		    background-color: rgba(0, 0, 0, 0.5);  
		    bottom: 60%;  
		    left: 0;  
		    right: 0;  
		    transform: translateY(50%);  
		    padding: 10px;  
		    border-radius: 5px;  
		}  
		  
		.book-actions {  
		    position: absolute;  
		    bottom: 10px;  
		    left: 50%;  
		    transform: translateX(-50%);  
		} 
		
        .icon-white {  
		    filter: invert(1); /* Inverte i colori dell'immagine */ 
		    padding: 5px 10px;  
		    border-radius: 5px;  
		    margin-top: 20px;   
		}   
		
        .icon-white:hover {  
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);  
		    background-color: #3a6cb3;  
		    color: white;  
		    padding: 5px 10px;  
		    border-radius: 5px;  
		    margin-top: 20px;   
		} 
		  
		.carousel-item img.d-block {  
		  max-width: 30%; /* Ridimensiona l'immagine del carousel al 60% della sua larghezza originale */  
		  max-height: 30%; /* Ridimensiona l'immagine del carousel al 60% della sua altezza originale */  
		  margin: 0 auto; /* Centra l'immagine del carousel orizzontalmente */  
		} 
		
		.carousel-item {
		  max-height: 200px;
		}
    </style>  
</head>  
<body>  
    <section layout:fragment="content" class="container book-details-container">  
        <div class="book-details">  
            <h1 class="book-title" th:text="${book.title}">Titolo del libro</h1>  
            <img class="book-cover" th:src="${book.imageUrl}" alt="Copertina del libro" />  
            <div class="book-info">  
                <div>Author: <span th:text="${book.author}">Autore</span></div>  
                <div>Publication Year: <span th:text="${book.publicationYear}">Anno di pubblicazione</span></div>  
                <div>Genre: <span th:text="${book.genre}">Genere</span></div>  
				<div class="rating-stars" th:if="${countOfRatings > 0}" th:attr="data-book-rating=${sumOfRatings/countOfRatings}"></div>
	            <div class="rating-stars" th:if="${countOfRatings == 0}">Nessun voto</div> <br/>
				<div id="similarBooksCarousel" class="carousel slide" data-ride="carousel">  
				    <h4>Libri simili</h4>  
				    <div class="carousel-inner">  
				        <div th:each="similarBook, iter : ${similarBooks}" class="carousel-item similar-book" th:classappend="${iter.first} ? 'active' : ''">  
						    <img th:src="${similarBook.imageUrl}" class="d-block w-100" alt="Copertina del libro" />  
						    <div class="carousel-caption d-none d-md-block"> 
							    <a class="carousel-control-prev" href="#similarBooksCarousel" role="button" data-slide="prev">  
							        <span class="carousel-control-prev-icon" aria-hidden="true"></span>  
							        <span class="sr-only">Previous</span>  
							    </a>   
						        <h3 th:text="${similarBook.title}">Titolo del libro</h3>  
						        <p>Author: <span th:text="${similarBook.author}">Autore</span></p>  
							    <a class="carousel-control-next" href="#similarBooksCarousel" role="button" data-slide="next">  
							        <span class="carousel-control-next-icon" aria-hidden="true"></span>  
							        <span class="sr-only">Next</span>  
							    </a>  
						    </div>  
						    <div class="book-actions">  
						        <a th:href="@{/books/{id}(id=${similarBook.id})}">  
						            <img src="https://img.icons8.com/material-outlined/24/000000/zoom-in.png" alt="View" class="icon-white"/>  
						        </a>  
						    </div>  
						</div>
				    </div>  
				</div> 
				<a href="/books" class="back-to-books-btn">  
				    <span class="back-to-books-icon">&larr;</span> Back to Books  
				</a>  
            </div>  
        </div>   
		<script>  
				function handleStarClick(starIndex, element) {   
				    const rating = starIndex;  
				    const form = element.parentElement.parentElement;  
				    form.getElementsByClassName('rating-input')[0].value = rating;
				    form.submit();  
				} 
			  function renderRatingStars(rating) {  
				    const fullStar = '<span style="color: gold;"';  
				    const emptyStar = '<span style="color: lightgrey;"';  
				    const endStar = '>â˜…</span>';
				    const stars = []; 
				  
				    for (let i = 1; i <= 5; i++) { 
				      completeStar = ''; 
				      if (i <= Math.round(rating)) {  
				        completeStar = fullStar + ' onClick="handleStarClick(' + i + ', this)"' + endStar;  
				      } else {  
				        completeStar = emptyStar + ' onClick="handleStarClick(' + i + ', this)"' + endStar;
				      }  
				      stars.push(completeStar);  
				    }  
				  
				    return stars.join(''); 
				  }  
			 function loadAverageRatings() {  
			    $('.rating-stars').each(function() {  
			      const averageRating = $(this).data('book-rating'); 
			      const ratingStars = renderRatingStars(averageRating);  
        		  $(this).html(ratingStars); 
			    });   
			  }
			 
			 $(document).ready(function() {  
				    loadAverageRatings();  
				  
				    // Inizializza lo slider  
				    $('.slider').slick({  
				        slidesToShow: 3,  
				        slidesToScroll: 1,  
				        autoplay: true,  
				        autoplaySpeed: 2000,  
				        responsive: [  
				            {  
				                breakpoint: 768,  
				                settings: {  
				                    slidesToShow: 2,  
				                    slidesToScroll: 1  
				                }  
				            },  
				            {  
				                breakpoint: 480,  
				                settings: {  
				                    slidesToShow: 1,  
				                    slidesToScroll: 1  
				                }  
				            }  
				        ]  
				    });  
				});  
			  
			  $(document).ready(loadAverageRatings); 
			</script>
    </section>  
</body>  
</html>  
